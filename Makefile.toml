env_files = [".env"]

[tasks.build-wasm]
command = "wasm-pack"
args = ["build", "--out-dir", "../sdk/wasm", "rollbar"]

[tasks.create-wasm-link]
command = "yarn"
args = ["--cwd", "./sdk/wasm", "link"]

[tasks.link-wasm]
command = "yarn"
args = ["--cwd", "./examples/nextjs", "link", "rollbar"]

[tasks.before-build-node]
command = "yarn"
args = ["--cwd", "./sdk/node", "install"]

[tasks.build-node]
command = "yarn"
args = ["--cwd", "./sdk/node", "build"]
dependencies = ["before-build-node"]

[tasks.create-node-link]
command = "yarn"
args = ["--cwd", "./sdk/node", "link"]

[tasks.link-node]
command = "yarn"
args = ["--cwd", "./examples/nodejs", "link", "rollbar-node"]

[tasks.before-nextjs-example]
command = "yarn"
args = ["--cwd", "./examples/nextjs", "install"]

[tasks.run-nextjs-example]
command = "yarn"
args = ["--cwd", "./examples/nextjs", "dev"]
dependencies = [
  "build-wasm",
  "create-wasm-link",
  "link-wasm",
  "before-nextjs-example",
]

[tasks.before-nodejs-example]
command = "yarn"
args = ["--cwd", "./examples/nodejs", "install"]

[tasks.run-nodejs-example]
command = "node"
args = ["./examples/nodejs/index.js"]
dependencies = [
  "before-nodejs-example",
  "build-node",
  "create-node-link",
  "link-node",
]

[tasks.make-c-workspace]
command = "mkdir"
args = ["-p", "build"]

[tasks.prepare-c-workspace]
command = "cmake"
cwd = "build"
args = [".."]
dependencies = ["make-c-workspace"]

[tasks.compile-c-example]
command = "make"
cwd = "build"
dependencies = ["prepare-c-workspace"]

[tasks.run-c-example]
command = "build/examples/cpp/example-cpp"
dependencies = ["compile-c-example"]